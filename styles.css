/* Moodle Task Viewer - Moodle-Themed Styles */

/*
  Overview:
  - This stylesheet defines the visual layout and theme for the floating
    Moodle Task Viewer. The file uses CSS variables provided by the content
    script (see `applyColorsToViewer()` in `content.js`) to allow runtime
    theming controlled by user settings.

  Major sections below:
  - Viewer container & positioning
  - Header and action controls
  - Filters (tabs) and pills
  - Scrollable content area and assignment items
  - Custom controls (pills, restore/hide buttons)
  - Settings panel and responsive rules
*/

.moodle-floating-viewer {
  position: fixed;
  width: 400px;
  min-width: 400px;
  max-height: 1300px;
  min-height: 220px;
  /* Use the viewer background variable so the expanded area matches
     the assignments' surrounding background and feels like one panel. */
  background: var(--viewer-bg, #f9f9f9);
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
  z-index: 10000;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Open Sans', sans-serif;
  transition: opacity 0.3s ease;
  overflow: hidden;
  border: 1px solid #ddd;
  direction: rtl;
  padding-bottom: 0; /* reduce bottom padding to remove excess white space */
}

.viewer-resize-handle {
  position: absolute;
  right: 6px;
  bottom: 8px;
  width: 18px;
  height: 18px;
  background: linear-gradient(135deg, var(--primary, #f98012) 0%, var(--secondary, #ff6f00) 50%, var(--tertiary, #2d9fd8) 100%);
  border-radius: 4px;
  cursor: nwse-resize;
  z-index: 10001;
  display: flex;
  align-items: center;
  justify-content: center;
}
.viewer-resize-handle:after {
  content: '';
  display: block;
  width: 10px;
  height: 10px;
  border-right: 2px solid rgba(255,255,255,0.9);
  border-bottom: 2px solid rgba(255,255,255,0.9);
  opacity: 0.9;
}

.viewer-header {
  background: linear-gradient(135deg, var(--primary, #f98012) 0%, var(--secondary, #ff6f00) 50%, var(--tertiary, #2d9fd8) 100%);
  color: white;
  padding: 14px 16px;
  cursor: move;
  display: flex;
  justify-content: space-between;
  align-items: center;
  user-select: none;
  border-bottom: 2px solid rgba(255, 255, 255, 0.2);
}

.viewer-actions {
  /* Action buttons container (right-hand side in the header)
     Contains profile icons and small control buttons. */
  display: flex;
  gap: 8px;
  align-items: center;
}

.viewer-title {
  display: flex;
  align-items: center;
  gap: 8px;
}

.drag-handle {
  font-size: 18px;
  opacity: 0.8;
  cursor: grab;
  line-height: 1;
}

.viewer-title h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.viewer-toggle {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  font-size: 20px;
  width: 30px;
  height: 30px;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  line-height: 1;
  padding: 0;
  font-weight: 400;
}

.viewer-toggle:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: scale(1.05);
}

.viewer-settings {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  font-size: 18px;
  width: 30px;
  height: 30px;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  line-height: 1;
  padding: 0;
  font-weight: 400;
}

.viewer-settings:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: scale(1.05);
}

/* ------------------------------
   Filters bar
   - Horizontal row of small filter buttons (tabs).
   - Default state uses the tertiary color for a subtle background, active
     state uses primary→secondary gradient. Text contrast is computed via
     the `--filter-fg` variable set by the content script.
   ------------------------------ */
.viewer-filters {
  display: flex;
  gap: 6px;
  padding: 10px;
  background: #f5f5f5;
  border-bottom: 1px solid #e0e0e0;
  overflow-x: auto;
}

.filter-btn {
  background: var(--tertiary, #ffffff);
  border: 1px solid rgba(0,0,0,0.06);
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
  color: var(--filter-fg, #333);
  font-weight: 500;
}

.filter-btn:hover {
  background: rgba(255,255,255,0.06);
  border-color: var(--secondary, #ff6f00);
}

.filter-btn.active {
  background: linear-gradient(135deg, var(--primary, #f98012), var(--secondary, #ff6f00));
  color: var(--primary-contrast, #fff);
  border-color: var(--primary, #f98012);
  font-weight: 600;
}

.viewer-content {
  max-height: 450px;
  overflow-y: auto;
  padding: 10px;
  /* Make content transparent so the viewer's background shows through
     and the assignments feel like part of one cohesive panel. */
  background: transparent;
}

.viewer-content::-webkit-scrollbar {
  width: 6px;
}

.viewer-content::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.viewer-content::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb, #f98012);
  border-radius: 3px;
}

.viewer-content::-webkit-scrollbar-thumb:hover {
  background: #e67000;
}

.assignment-item {
  background: var(--card-bg, #ffffff);
  border-radius: 6px;
  padding: 12px;
  margin-bottom: 8px;
  transition: all 0.2s;
  border-right: 4px solid #f98012;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  position: relative; /* ensure absolute children position correctly */
}

.assignment-item:hover {
  /* Hover state for assignment cards - subtle lift and shadow
     Color accents are controlled by CSS variables (border, icons).
     The transform provides a micro-interaction to indicate focus. */
  background: #fff8f0;
  transform: translateX(-3px);
  box-shadow: 0 2px 6px rgba(249, 128, 18, 0.2);
}

.assignment-item.overdue {
  border-right-color: #d32f2f;
  background: #fff5f5;
}

.assignment-item.overdue:hover {
  background: #ffe8e8;
}

.custom-draggable {
  position: relative;
  cursor: move;
}

/* ------------------------------
   Custom draggable items
   - `.custom-draggable` marks items that can be reordered via drag/drop.
   - A floating hide button appears on hover (see `.assignment-hide-btn`).
   ------------------------------ */

.assignment-hide-btn {
  /* Per-item hide action (shown on hover for draggable items)
     Uses a small circular button positioned in the card corner. */
  position: absolute;
  left: 8px;
  top: 8px;
  background: #ff6b6b;
  color: white;
  border: none;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s;
  display: none;
}

.custom-draggable:hover .assignment-hide-btn {
  display: flex;
  align-items: center;
  justify-content: center;
}

.assignment-hide-btn:hover {
  /* Hover state for the per-item hide button (destructive action)
     Slight scale to indicate interactivity. Background may be themed via JS. */
  background: #d32f2f;
  transform: scale(1.1);
}


/* ------------------------------
   Custom controls area
   - Contains the custom-tab controls (toggle show hidden / restore all)
   - Uses pill-style buttons defined below.
   ------------------------------ */
.custom-controls {
  padding: 8px;
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
}

/* ------------------------------
   Custom pill controls
   - `.custom-toggle-btn` and `.custom-restore-btn` are pill-shaped buttons
     used in the Custom tab. Their visuals are controlled by CSS variables
     (set by the content script) so they follow user-selected theme colors.
   ------------------------------ */
.custom-toggle-btn, .custom-restore-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: 999px; /* pill */
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid rgba(0,0,0,0.06);
  background: linear-gradient(135deg, var(--primary, #f98012), var(--secondary, #ff6f00));
  color: var(--primary-contrast, white);
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
}

.custom-toggle-btn .btn-icon, .custom-restore-btn .btn-icon {
  width: 18px;
  height: 18px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.custom-toggle-btn:hover, .custom-restore-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 28px rgba(0,0,0,0.16);
}



/* ------------------------------
   Per-assignment restore button (hidden view)
   - Shown only inside `.hidden-view` to allow users to restore a hidden item.
   - Styled with primary color by the content script to match theme.
   ------------------------------ */
.assignment-restore-btn {
  position: absolute;
  left: 8px; /* aligns with hide button area in RTL layout */
  top: 8px;
  width: 36px;
  height: 36px;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,0.06);
  background: white;
  /* Provide a sensible foreground color when the background is light
     (e.g. when primary color is white). JS can override --restore-fg. */
  color: var(--restore-fg, #2d9fd8);
  box-shadow: 0 1px 0 rgba(0,0,0,0.04);
  background-clip: padding-box;
  display: none; /* default hidden */
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.12s ease, box-shadow 0.12s ease;
}

.hidden-view .assignment-restore-btn { display: inline-flex; }

.assignment-restore-btn svg {
  width: 16px;
  height: 16px;
  display: block;
  /* Force a readable fill for the restore icon. Use the CSS variable
     if available; otherwise fall back to a visible accent color. Use
     !important to override inline styles or inherited colors. */
  fill: var(--restore-fg, #2d9fd8) !important;
  stroke: rgba(0,0,0,0.06);
  stroke-width: 0.5;
}

/* If the restore icon still isn't visible due to complex SVG, apply a
   subtle background ring so the button reads against white. */
.assignment-restore-btn {
  box-shadow: 0 1px 0 rgba(0,0,0,0.04), 0 0 0 1px rgba(0,0,0,0.02) inset;
}

.assignment-restore-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 14px rgba(45,159,216,0.12);
}

/* Make sure hide button and restore don't visually clash */


/* Ensure toggle/restore svg icons inherit button color */
.custom-toggle-btn svg, .custom-restore-btn svg { fill: currentColor; }

/* (removed forced blue for #reset-colors-btn so user color settings apply) */

.assignment-link {
  text-decoration: none;
  color: inherit;
  display: block;
}

.assignment-header {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 8px;
}

.assignment-icon {
  font-size: 18px;
  flex-shrink: 0;
  margin-top: 2px;
}

.assignment-info {
  flex: 1;
  text-align: right;
}

.assignment-title {
  font-weight: 600;
  font-size: 14px;
  color: #333;
  line-height: 1.4;
  margin-bottom: 4px;
}

.assignment-course {
  font-size: 12px;
  color: #666;
  font-weight: 400;
  line-height: 1.3;
}

.assignment-time {
  font-size: 12px;
  color: #666;
  font-family: 'Courier New', monospace;
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  background: #f5f5f5;
  border-radius: 4px;
  width: fit-content;
  margin-right: 26px;
}

.time-icon {
  font-size: 14px;
}

.no-assignments {
  text-align: center;
  color: #666;
  padding: 16px 12px;
  font-style: italic;
  font-size: 14px;
  background: white;
  border-radius: 6px;
  margin: 8px;
}

.viewer-footer {
  /* Place footer absolutely so its small label can be positioned to
     sit next to the resize handle and move along with it. Keep the
     visual background transparent so it blends with the viewer. */
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 8px 12px;
  text-align: center;
  border-top: 1px solid rgba(0,0,0,0.04);
  color: #666;
  font-size: 11px;
  background: transparent;
  z-index: 10000;
}

/* Ensure the small label inside the footer sits to the left of the resize
   handle and moves with the container size. The right offset matches the
   handle's right + width + a small gap (6px + 18px + 6px = 30px). */
.viewer-footer small {
  display: inline-block;
  background: rgba(255,255,255,0.0);
  padding: 2px 6px;
  border-radius: 4px;
  color: #666;
}

/* Make the viewer body a positioned container so the absolute footer
   is anchored correctly and content won't be overlapped. */
.viewer-body {
  padding-bottom: 56px; /* make room for footer + resize handle */
}

/* Collapsed state */
.moodle-floating-viewer.viewer-collapsed-state {
  width: 60px !important;
  height: 60px !important;
  min-width: 60px !important;
  min-height: 60px !important;
  max-width: 60px !important;
  max-height: 60px !important;
  padding: 0;
  overflow: visible;
}

.viewer-collapsed {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #f98012 0%, #ff6f00 50%, #2d9fd8 100%);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
  user-select: none;
}

.viewer-collapsed:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
}

.collapsed-icon {
  font-size: 28px;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

/* Profile link icons in header */
.profile-link {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 34px;
  height: 34px;
  border-radius: 6px;
  color: white;
  text-decoration: none;
  transition: transform 0.15s ease, background 0.15s ease;
  background: rgba(255,255,255,0.06);
}
.profile-link svg {
  width: 18px;
  height: 18px;
  display: block;
  fill: white;
}
.profile-link:hover {
  transform: scale(1.05);
  background: rgba(255,255,255,0.12);
}

/* Settings Panel */
.settings-panel {
  position: fixed;
  top: 50%;
  right: 50%;
  transform: translate(50%, -50%);
  width: 500px;
  max-width: 90vw;
  max-height: 80vh;
  background: white;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  z-index: 10001;
  display: none;
  direction: rtl;
  overflow: hidden;
}

/* ------------------------------
   Settings panel content
   - The settings modal contains the color pickers, quick links and options.
   - Buttons inside the panel use theme variables so their colors match the
     rest of the UI (see `applyColorsToViewer()` in `content.js`).
   ------------------------------ */

.settings-header {
  /* Header for the settings modal uses the theme gradient variables so
     the panel matches the user's selected colors. Uses --primary/--secondary/--tertiary. */
  background: linear-gradient(135deg, var(--primary, #f98012) 0%, var(--secondary, #ff6f00) 50%, var(--tertiary, #2d9fd8) 100%);
  color: white;
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid rgba(255, 255, 255, 0.2);
}

.settings-header h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

.settings-close {
  /* Close button in the settings header - uses primary color for contrast
     but keeps a semi-transparent style so it reads well on the gradient. */
  background: rgba(255, 255, 255, 0.12);
  border: 1px solid rgba(255, 255, 255, 0.18);
  color: var(--primary-contrast, white);
  font-size: 24px;
  width: 32px;
  height: 32px;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  line-height: 1;
  padding: 0;
}

.settings-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.1);
}

.settings-content {
  padding: 20px;
  overflow-y: auto;
  max-height: calc(80vh - 70px);
}

.settings-section {
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid #e0e0e0;
}

.settings-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.settings-section h4 {
  margin: 0 0 16px 0;
  font-size: 16px;
  font-weight: 600;
  color: #333;
}

.settings-section .input-control a {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: #1a1a1a;
  text-decoration: none;
  font-size: 13px;
}

.settings-section .input-control .contact-email {
  font-size: 13px;
  color: #333;
  direction: ltr;
  text-decoration: none;
}

.color-control {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.color-control label {
  min-width: 80px;
  font-size: 14px;
  color: #666;
}

.color-control input[type="color"] {
  width: 50px;
  height: 35px;
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: pointer;
  padding: 2px;
}

.color-control input[type="text"] {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  font-family: 'Courier New', monospace;
}

.input-control {
  margin-bottom: 12px;
}

.input-control label {
  display: block;
  margin-bottom: 6px;
  font-size: 14px;
  color: #666;
  font-weight: 500;
}

.input-control input {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  box-sizing: border-box;
}

.checkbox-control {
  margin-bottom: 12px;
}

.checkbox-control label {
  display: flex;
  align-items: center;
  font-size: 13px;
  color: #333;
  font-weight: 400;
  cursor: pointer;
  gap: 8px;
}

.checkbox-control input[type="checkbox"] {
  width: 16px;
  height: 16px;
  cursor: pointer;
  accent-color: #f98012;
}

.input-control input:focus {
  outline: none;
  border-color: #f98012;
  box-shadow: 0 0 0 2px rgba(249, 128, 18, 0.1);
}

.settings-btn {
  background: linear-gradient(135deg, var(--primary, #f98012), var(--secondary, #ff6f00));
  color: var(--primary-contrast, white);
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 8px;
  float: left; /* place buttons on the left side of the panel */
}

.settings-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

.settings-btn-secondary {
  background: var(--tertiary, #2d9fd8);
  color: var(--tertiary-contrast, #fff);
  margin-left: 8px; /* spacing between the two left-aligned buttons */
  float: left;
}

.settings-btn-secondary:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

#links-container {
  margin-bottom: 12px;
}

/* Keep the "הוסף קישור" button on the right side regardless of
   the general .settings-btn float. Uses ID selector to override. */
#add-link-btn {
  float: right;
  margin-top: 8px;
}

/* Ensure floated buttons don't collapse the section layout */
.settings-section::after {
  content: '';
  display: table;
  clear: both;
}

/* Fix minor border/glitch issues: ensure buttons have consistent borders
   and that backgrounds don't bleed over rounded corners. JS will still
   set inline colors; these rules are conservative fallbacks. */
.settings-btn, .settings-btn-secondary, .custom-toggle-btn, .custom-restore-btn, .filter-btn, .assignment-hide-btn {
  border: 1px solid rgba(0,0,0,0.08);
  background-clip: padding-box;
}

/* ------------------------------
   Quick-links list
   - Renders saved quick-links added by the user in settings. Items are
     neutral in color and use accent color for link text.
   ------------------------------ */

.link-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  background: #f5f5f5;
  border-radius: 6px;
  margin-bottom: 8px;
  transition: all 0.2s;
}

.link-item:hover {
  background: #eeeeee;
}

.link-name {
  flex: 1;
  color: #2d9fd8;
  text-decoration: none;
  font-size: 14px;
}

.link-name:hover {
  text-decoration: underline;
}

.link-delete {
  background: transparent;
  border: none;
  font-size: 16px;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  transition: all 0.2s;
}

.link-delete:hover {
  background: #ffebee;
  transform: scale(1.1);
}

@media (max-width: 768px) {
  .moodle-floating-viewer {
    width: 320px;
    max-height: 450px;
  }
  
  .assignment-title {
    font-size: 13px;
  }
  
  .assignment-time {
    font-size: 11px;
  }
  
  .filter-btn {
    font-size: 11px;
    padding: 5px 10px;
  }
  
  .settings-panel {
    width: 95vw;
  }
}

/* ------------------------------
   Header & Top Actions
   - Contains the drag handle, static profile links and the small control
     buttons (toggle/settings). Header uses a gradient based on CSS vars.
   ------------------------------ */